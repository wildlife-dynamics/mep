# AUTOGENERATED BY ECOSCOPE-WORKFLOWS; see fingerprint in README.md for details


from __future__ import annotations

from enum import Enum
from typing import Any, Dict, List, Literal, Optional, Union

from pydantic import (
    AwareDatetime,
    BaseModel,
    ConfigDict,
    Field,
    RootModel,
    confloat,
    constr,
)


class WorkflowDetails(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    name: str = Field(..., title="Workflow Name")
    description: Optional[str] = Field("", title="Workflow Description")


class Url(str, Enum):
    https___tile_openstreetmap_org__z___x___y__png = (
        "https://tile.openstreetmap.org/{z}/{x}/{y}.png"
    )


class BaseMaps(BaseModel):
    url: Literal["https://tile.openstreetmap.org/{z}/{x}/{y}.png"] = Field(
        "https://tile.openstreetmap.org/{z}/{x}/{y}.png", title="Preset Layer URL"
    )
    opacity: Optional[confloat(ge=0.0, le=1.0)] = Field(
        1,
        description="Set layer transparency from 1 (fully visible) to 0 (hidden).",
        title="Layer Opacity",
    )


class Url1(str, Enum):
    https___server_arcgisonline_com_ArcGIS_rest_services_World_Street_Map_MapServer_tile__z___y___x_ = "https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}"


class BaseMaps1(BaseModel):
    url: Literal[
        "https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}"
    ] = Field(
        "https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",
        title="Preset Layer URL",
    )
    opacity: Optional[confloat(ge=0.0, le=1.0)] = Field(
        1,
        description="Set layer transparency from 1 (fully visible) to 0 (hidden).",
        title="Layer Opacity",
    )


class Url2(str, Enum):
    https___server_arcgisonline_com_ArcGIS_rest_services_World_Imagery_MapServer_tile__z___y___x_ = "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"


class BaseMaps2(BaseModel):
    url: Literal[
        "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"
    ] = Field(
        "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
        title="Preset Layer URL",
    )
    opacity: Optional[confloat(ge=0.0, le=1.0)] = Field(
        1,
        description="Set layer transparency from 1 (fully visible) to 0 (hidden).",
        title="Layer Opacity",
    )


class Url3(str, Enum):
    https___server_arcgisonline_com_ArcGIS_rest_services_World_Topo_Map_MapServer_tile__z___y___x_ = "https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}"


class BaseMaps3(BaseModel):
    url: Literal[
        "https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}"
    ] = Field(
        "https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",
        title="Preset Layer URL",
    )
    opacity: Optional[confloat(ge=0.0, le=1.0)] = Field(
        1,
        description="Set layer transparency from 1 (fully visible) to 0 (hidden).",
        title="Layer Opacity",
    )


class Url4(str, Enum):
    https___tiles_arcgis_com_tiles_POUcpLYXNckpLjnY_arcgis_rest_services_landDx_basemap_tiles_mapservice_MapServer_tile__z___y___x_ = "https://tiles.arcgis.com/tiles/POUcpLYXNckpLjnY/arcgis/rest/services/landDx_basemap_tiles_mapservice/MapServer/tile/{z}/{y}/{x}"


class BaseMaps4(BaseModel):
    url: Literal[
        "https://tiles.arcgis.com/tiles/POUcpLYXNckpLjnY/arcgis/rest/services/landDx_basemap_tiles_mapservice/MapServer/tile/{z}/{y}/{x}"
    ] = Field(
        "https://tiles.arcgis.com/tiles/POUcpLYXNckpLjnY/arcgis/rest/services/landDx_basemap_tiles_mapservice/MapServer/tile/{z}/{y}/{x}",
        title="Preset Layer URL",
    )
    opacity: Optional[confloat(ge=0.0, le=1.0)] = Field(
        1,
        description="Set layer transparency from 1 (fully visible) to 0 (hidden).",
        title="Layer Opacity",
    )


class Url5(str, Enum):
    https___server_arcgisonline_com_arcgis_rest_services_Elevation_World_Hillshade_MapServer_tile__z___y___x_ = "https://server.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer/tile/{z}/{y}/{x}"


class BaseMaps5(BaseModel):
    url: Literal[
        "https://server.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer/tile/{z}/{y}/{x}"
    ] = Field(
        "https://server.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer/tile/{z}/{y}/{x}",
        title="Preset Layer URL",
    )
    opacity: Optional[confloat(ge=0.0, le=1.0)] = Field(
        1,
        description="Set layer transparency from 1 (fully visible) to 0 (hidden).",
        title="Layer Opacity",
    )


class BaseMaps6(BaseModel):
    url: Optional[
        constr(
            pattern=r"https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}([-a-zA-Z0-9()@:%_\+.~#?&//=\{\}]*)"
        )
    ] = Field(
        "https://example.tiles.com/{z}/{x}/{y}.png",
        description="The URL of a publicly accessible tiled raster service.",
        title="Custom Layer URL",
    )
    opacity: Optional[confloat(ge=0.0, le=1.0)] = Field(
        1,
        description="Set layer transparency from 1 (fully visible) to 0 (hidden).",
        title="Custom Layer Opacity",
    )
    max_zoom: Optional[int] = Field(
        None,
        description="Set the maximum zoom level to fetch tiles for.",
        title="Custom Layer Max Zoom",
    )
    min_zoom: Optional[int] = Field(
        None,
        description="Set the minimum zoom level to fetch tiles for.",
        title="Custom Layer Min Zoom",
    )


class ConfigureBaseMaps(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    base_maps: Optional[
        List[
            Union[
                BaseMaps,
                BaseMaps1,
                BaseMaps2,
                BaseMaps3,
                BaseMaps4,
                BaseMaps5,
                BaseMaps6,
            ]
        ]
    ] = Field(
        [
            {
                "url": "https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",
                "opacity": 1,
            },
            {
                "url": "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
                "opacity": 0.5,
            },
        ],
        description="Select tile layers to use as base layers in map outputs. The first layer in the list will be the bottommost layer displayed.",
        title=" ",
    )


class DefineTimeRange(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    since: AwareDatetime = Field(..., description="The start time", title="Since")
    until: AwareDatetime = Field(..., description="The end time", title="Until")


class CreateOutputDir(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    path_name: Optional[str] = Field(
        "/home/ttemu/ecoscope-workflows/mep/.pixi/envs/compile/lib/python3.12/site-packages/ecoscope_workflows_ext_mep/tasks/output",
        description="Path to the directory that should be created",
        title="Path Name",
    )


class RetrieveLdxDb(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    overwrite_existing: Optional[bool] = Field(
        False,
        description="Overwrite the existing file if it exists",
        title="Overwrite Existing",
    )
    unzip: Optional[bool] = Field(
        True, description="Whether to unzip the downloaded file", title="Unzip"
    )


class LoadAoi(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    aoi: List[str] = Field(..., title="Aoi")


class SubjectDf(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    bbox: Optional[List] = Field(
        None,
        description="Bounding box filter as (west, south, east, north). Includes subjects with track data inside the box.",
        title="Bbox",
    )
    subject_group_id: Optional[str] = Field(
        None,
        description="Subject group ID to filter subjects by.",
        title="Subject Group Id",
    )
    subject_group_name: Optional[str] = Field(
        None,
        description="Subject group name to filter subjects by.",
        title="Subject Group Name",
    )
    name: Optional[str] = Field(
        None, description="Filter subjects by name.", title="Name"
    )
    updated_since: Optional[str] = Field(
        None,
        description="Only include subjects updated since this timestamp (ISO).",
        title="Updated Since",
    )
    updated_until: Optional[str] = Field(
        None,
        description="Only include subjects updated until this timestamp (ISO).",
        title="Updated Until",
    )
    tracks: Optional[bool] = Field(
        None,
        description="Whether to include recent tracks for each subject.",
        title="Tracks",
    )
    ids: Optional[List[str]] = Field(
        None,
        description="List of subject IDs to fetch. Splits requests in chunks if large.",
        title="Ids",
    )
    max_ids_per_request: Optional[int] = Field(
        50,
        description="Maximum number of IDs per request when splitting batched subject queries.",
        title="Max Ids Per Request",
    )
    raise_on_empty: Optional[bool] = Field(
        True,
        description="Whether to abort the workflow if no subjects are returned from EarthRanger.",
        title="Raise On Empty",
    )


class DownloadSubjectInfo(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    return_data: Optional[bool] = Field(True, title="Return Data")


class GetEventsData(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    event_types: List[str] = Field(
        ...,
        description="Specify the event type(s) to analyze (optional). Leave this section empty to analyze all event types. Only V1 Event Types can be analyzed at this time.",
        title="Event Types",
    )
    include_null_geometry: Optional[bool] = Field(
        True, title="Include Events Without a Geometry (point or polygon)"
    )
    include_updates: Optional[bool] = Field(
        False,
        description="Whether or not to include event updates",
        title="Include Updates",
    )
    include_related_events: Optional[bool] = Field(
        False,
        description="Whether or not to include related events",
        title="Include Related Events",
    )


class ViewEventsDf(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    name: str = Field(..., title="Name")


class SubjectObservations(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    subject_group_name: str = Field(..., title="Subject Group Name")


class SortTrajsBySpeed(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    ascending: Optional[bool] = Field(
        True, description="Sort ascending if true", title="Ascending"
    )


class ZoomTrajView(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    zoom_value: Optional[float] = Field(14, title="Zoom Value")


class ZoomHrView(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    zoom_value: Optional[float] = Field(14, title="Zoom Value")


class ZoomSeasonView(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    zoom_value: Optional[float] = Field(14, title="Zoom Value")


class Filetype(str, Enum):
    csv = "csv"
    gpkg = "gpkg"
    geoparquet = "geoparquet"


class PersistSubjectSeasonWins(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    filetype: Optional[Filetype] = Field(
        "csv", description="The output format", title="Filetype"
    )


class GoogleEarthEngineConnection(BaseModel):
    name: str = Field(..., title="Data Source")


class EarthRangerConnection(BaseModel):
    name: str = Field(..., title="Data Source")


class TemporalGrouper(RootModel[str]):
    root: str = Field(..., title="Time")


class ValueGrouper(RootModel[str]):
    root: str = Field(..., title="Category")


class MapStyleConfig(BaseModel):
    styles: Optional[Dict[str, Dict[str, Any]]] = Field(None, title="Styles")
    legend: Optional[Dict[str, List[str]]] = Field(None, title="Legend")


class TrajectorySegmentFilter(BaseModel):
    min_length_meters: Optional[confloat(ge=0.001)] = Field(
        0.001, title="Minimum Segment Length (Meters)"
    )
    max_length_meters: Optional[confloat(gt=0.001)] = Field(
        100000, title="Maximum Segment Length (Meters)"
    )
    min_time_secs: Optional[confloat(ge=1.0)] = Field(
        1, title="Minimum Segment Duration (Seconds)"
    )
    max_time_secs: Optional[confloat(gt=1.0)] = Field(
        172800, title="Maximum Segment Duration (Seconds)"
    )
    min_speed_kmhr: Optional[confloat(gt=0.001)] = Field(
        0.01, title="Minimum Segment Speed (Kilometers per Hour)"
    )
    max_speed_kmhr: Optional[confloat(gt=0.001)] = Field(
        500, title="Maximum Segment Speed (Kilometers per Hour)"
    )


class AutoScaleOrCustom(str, Enum):
    Auto_scale = "Auto-scale"


class AutoScaleGridCellSize(BaseModel):
    auto_scale_or_custom: Literal["Auto-scale"] = Field(
        "Auto-scale",
        description="Define the resolution of the raster grid (in meters per pixel).",
        title=" ",
    )


class AutoScaleOrCustom1(str, Enum):
    Customize = "Customize"


class CustomGridCellSize(BaseModel):
    auto_scale_or_custom: Literal["Customize"] = Field(
        "Customize",
        description="Define the resolution of the raster grid (in meters per pixel).",
        title=" ",
    )
    grid_cell_size: Optional[confloat(lt=10000.0, gt=0.0)] = Field(
        5000, description="Custom Raster Pixel Size (Meters)", title="Grid Cell Size"
    )


class GeeClient(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    data_source: GoogleEarthEngineConnection = Field(
        ..., description="Select one of your configured data sources.", title=""
    )


class ErClient(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    data_source: EarthRangerConnection = Field(
        ..., description="Select one of your configured data sources.", title=""
    )


class ConfigureGroupingStrategy(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    groupers: Optional[List[Union[ValueGrouper, TemporalGrouper]]] = Field(
        None,
        description="            Specify how the data should be grouped to create the views for your dashboard.\n            This field is optional; if left blank, all the data will appear in a single view.\n            ",
        title=" ",
    )


class CreateStyledLdxLayers(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    style_config: MapStyleConfig = Field(..., title="Style Config")


class ConvertToTrajectories(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    trajectory_segment_filter: Optional[TrajectorySegmentFilter] = Field(
        default_factory=lambda: TrajectorySegmentFilter.model_validate(
            {
                "min_length_meters": 0.001,
                "max_length_meters": 100000,
                "min_time_secs": 1,
                "max_time_secs": 172800,
                "min_speed_kmhr": 0.01,
                "max_speed_kmhr": 500,
            }
        ),
        description="Filter track data by setting limits on track segment length, duration, and speed. Segments outside these bounds are removed, reducing noise and to focus on meaningful movement patterns.",
        title=" ",
    )


class GenerateSeasonalEtd(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    auto_scale_or_custom_cell_size: Optional[
        Union[AutoScaleGridCellSize, CustomGridCellSize]
    ] = Field({"auto_scale_or_custom": "Auto-scale"}, title="Grid Cell Size")
    max_speed_factor: Optional[float] = Field(
        1.05,
        description="An estimate of the subject's maximum speed as a factor of the maximum measured speed value in the dataset.",
        title="Max Speed Factor (Kilometers per Hour)",
    )
    expansion_factor: Optional[float] = Field(
        1.05,
        description="Controls how far time density values spread across the grid, affecting the smoothness of the output.",
        title="Shape Buffer Expansion Factor",
    )


class GenerateEtd(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    auto_scale_or_custom_cell_size: Optional[
        Union[AutoScaleGridCellSize, CustomGridCellSize]
    ] = Field(
        {"auto_scale_or_custom": "Auto-scale"},
        title="Auto Scale Or Custom Grid Cell Size",
    )
    max_speed_factor: Optional[float] = Field(
        1.05,
        description="An estimate of the subject's maximum speed.",
        title="Max Speed Factor (Kilometers per Hour)",
    )
    expansion_factor: Optional[float] = Field(
        1.3,
        description="Controls how far time density values spread across the grid.",
        title="Shape Buffer Expansion Factor",
    )


class FormData(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    workflow_details: Optional[WorkflowDetails] = Field(
        None,
        description="Add information that will help to differentiate this workflow from another.",
        title="Set Workflow Details",
    )
    gee_client: Optional[GeeClient] = Field(
        None, title="Set Google Earth Engine Data Source"
    )
    er_client: Optional[ErClient] = Field(
        None, title="Connect to Earth Ranger instance"
    )
    configure_base_maps: Optional[ConfigureBaseMaps] = Field(
        None, title="Configure Base Map Layers"
    )
    configure_grouping_strategy: Optional[ConfigureGroupingStrategy] = Field(
        None, title="Configure grouping strategy"
    )
    define_time_range: Optional[DefineTimeRange] = Field(
        None,
        description="Choose the period of time to analyze.",
        title="Define time range",
    )
    create_output_dir: Optional[CreateOutputDir] = Field(
        None, title="Create output directory"
    )
    retrieve_ldx_db: Optional[RetrieveLdxDb] = Field(
        None, title="Retrieve and unpack landDX db"
    )
    load_aoi: Optional[LoadAoi] = Field(None, title="Load AOI from landDX")
    create_styled_ldx_layers: Optional[CreateStyledLdxLayers] = Field(
        None, title="Style landDX map layers"
    )
    subject_df: Optional[SubjectDf] = Field(None, title="Get subject dataframe")
    download_subject_info: Optional[DownloadSubjectInfo] = Field(
        None, title="Download subject info and persist"
    )
    get_events_data: Optional[GetEventsData] = Field(
        None, title="Retrieve events from ER"
    )
    view_events_df: Optional[ViewEventsDf] = Field(None, title="view events df")
    subject_observations: Optional[SubjectObservations] = Field(
        None, title="Get subject group observations from ER"
    )
    convert_to_trajectories: Optional[ConvertToTrajectories] = Field(
        None, title="Convert relocations to trajectories"
    )
    generate_seasonal_etd: Optional[GenerateSeasonalEtd] = Field(
        None, title="Generate seasonal home range etd"
    )
    sort_trajs_by_speed: Optional[SortTrajsBySpeed] = Field(
        None, title="Sort trajectories by speed bins"
    )
    zoom_traj_view: Optional[ZoomTrajView] = Field(
        None, title="Zoom speed trajectories by view state"
    )
    generate_etd: Optional[GenerateEtd] = Field(None, title="Generate hr etd")
    zoom_hr_view: Optional[ZoomHrView] = Field(
        None, title="Zoom hr movement by view state"
    )
    zoom_season_view: Optional[ZoomSeasonView] = Field(
        None, title="Zoom seasons by view state"
    )
    persist_subject_season_wins: Optional[PersistSubjectSeasonWins] = Field(
        None, title="Persist seasonal windows as csv"
    )
